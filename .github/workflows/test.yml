name: test

on:
  push:
    branches-ignore:
      - master

jobs:
  build-test:
    runs-on: macOS-latest
    
    steps:
    - uses: actions/checkout@v1

    - name: switch xcode version
      run: sudo xcode-select --switch /Applications/Xcode_12.app

    - name: install depencies
      run: pod install

    - name: build
      run: ./build_app.sh

    - name: make FireInstaller.pkg
      run: ./package/make_package.sh

    - name: generate appcast.xml
      env:
        sparkle_key: ${{ secrets.sparkle_key }}
      run: ./build_appcast.sh

    - uses: actions/upload-artifact@v2
      with:
        name: apps
        path: ./apps/